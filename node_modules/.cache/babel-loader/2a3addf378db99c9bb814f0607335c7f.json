{"ast":null,"code":"var events = require('./events');\n\nvar Store = require('./store');\n\nvar ui = require('./ui');\n\nvar Constants = require('./constants');\n\nvar xtend = require('xtend');\n\nmodule.exports = function (ctx) {\n  var controlContainer = null;\n  var mapLoadedInterval = null;\n  var setup = {\n    onRemove: function onRemove() {\n      // Stop connect attempt in the event that control is removed before map is loaded\n      ctx.map.off('load', setup.connect);\n      clearInterval(mapLoadedInterval);\n      setup.removeLayers();\n      ctx.store.restoreMapConfig();\n      ctx.ui.removeButtons();\n      ctx.events.removeEventListeners();\n      ctx.ui.clearMapClasses();\n      ctx.map = null;\n      ctx.container = null;\n      ctx.store = null;\n      if (controlContainer && controlContainer.parentNode) controlContainer.parentNode.removeChild(controlContainer);\n      controlContainer = null;\n      return this;\n    },\n    connect: function connect() {\n      ctx.map.off('load', setup.connect);\n      clearInterval(mapLoadedInterval);\n      setup.addLayers();\n      ctx.store.storeMapConfig();\n      ctx.events.addEventListeners();\n    },\n    onAdd: function onAdd(map) {\n      if (process.env.NODE_ENV !== 'test') {\n        // Monkey patch to resolve breaking change to `fire` introduced by\n        // mapbox-gl-js. See mapbox/mapbox-gl-draw/issues/766.\n        var _fire = map.fire;\n\n        map.fire = function (type, event) {\n          var args = arguments;\n\n          if (_fire.length === 1 && arguments.length !== 1) {\n            args = [xtend({}, {\n              type: type\n            }, event)];\n          }\n\n          return _fire.apply(map, args);\n        };\n      }\n\n      ctx.map = map;\n      ctx.events = events(ctx);\n      ctx.ui = ui(ctx);\n      ctx.container = map.getContainer();\n      ctx.store = new Store(ctx);\n      controlContainer = ctx.ui.addButtons();\n\n      if (ctx.options.boxSelect) {\n        map.boxZoom.disable(); // Need to toggle dragPan on and off or else first\n        // dragPan disable attempt in simple_select doesn't work\n\n        map.dragPan.disable();\n        map.dragPan.enable();\n      }\n\n      if (map.loaded()) {\n        setup.connect();\n      } else {\n        map.on('load', setup.connect);\n        mapLoadedInterval = setInterval(function () {\n          if (map.loaded()) setup.connect();\n        }, 16);\n      }\n\n      ctx.events.start();\n      return controlContainer;\n    },\n    addLayers: function addLayers() {\n      // drawn features style\n      ctx.map.addSource(Constants.sources.COLD, {\n        data: {\n          type: Constants.geojsonTypes.FEATURE_COLLECTION,\n          features: []\n        },\n        type: 'geojson'\n      }); // hot features style\n\n      ctx.map.addSource(Constants.sources.HOT, {\n        data: {\n          type: Constants.geojsonTypes.FEATURE_COLLECTION,\n          features: []\n        },\n        type: 'geojson'\n      });\n      ctx.options.styles.forEach(function (style) {\n        ctx.map.addLayer(style);\n      });\n      ctx.store.setDirty(true);\n      ctx.store.render();\n    },\n    // Check for layers and sources before attempting to remove\n    // If user adds draw control and removes it before the map is loaded, layers and sources will be missing\n    removeLayers: function removeLayers() {\n      ctx.options.styles.forEach(function (style) {\n        if (ctx.map.getLayer(style.id)) {\n          ctx.map.removeLayer(style.id);\n        }\n      });\n\n      if (ctx.map.getSource(Constants.sources.COLD)) {\n        ctx.map.removeSource(Constants.sources.COLD);\n      }\n\n      if (ctx.map.getSource(Constants.sources.HOT)) {\n        ctx.map.removeSource(Constants.sources.HOT);\n      }\n    }\n  };\n  ctx.setup = setup;\n  return setup;\n};","map":{"version":3,"sources":["C:/Users/michele/Desktop/IT/Code/react/aboutmi/node_modules/@mapbox/mapbox-gl-draw/src/setup.js"],"names":["events","require","Store","ui","Constants","xtend","module","exports","ctx","controlContainer","mapLoadedInterval","setup","onRemove","map","off","connect","clearInterval","removeLayers","store","restoreMapConfig","removeButtons","removeEventListeners","clearMapClasses","container","parentNode","removeChild","addLayers","storeMapConfig","addEventListeners","onAdd","process","env","NODE_ENV","_fire","fire","type","event","args","arguments","length","apply","getContainer","addButtons","options","boxSelect","boxZoom","disable","dragPan","enable","loaded","on","setInterval","start","addSource","sources","COLD","data","geojsonTypes","FEATURE_COLLECTION","features","HOT","styles","forEach","style","addLayer","setDirty","render","getLayer","id","removeLayer","getSource","removeSource"],"mappings":"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","sourcesContent":["const events = require('./events');\r\nconst Store = require('./store');\r\nconst ui = require('./ui');\r\nconst Constants = require('./constants');\r\nconst xtend = require('xtend');\r\n\r\nmodule.exports = function(ctx) {\r\n\r\n  let controlContainer = null;\r\n  let mapLoadedInterval = null;\r\n\r\n  const setup = {\r\n    onRemove: function() {\r\n      // Stop connect attempt in the event that control is removed before map is loaded\r\n      ctx.map.off('load', setup.connect);\r\n      clearInterval(mapLoadedInterval);\r\n\r\n      setup.removeLayers();\r\n      ctx.store.restoreMapConfig();\r\n      ctx.ui.removeButtons();\r\n      ctx.events.removeEventListeners();\r\n      ctx.ui.clearMapClasses();\r\n      ctx.map = null;\r\n      ctx.container = null;\r\n      ctx.store = null;\r\n\r\n      if (controlContainer && controlContainer.parentNode) controlContainer.parentNode.removeChild(controlContainer);\r\n      controlContainer = null;\r\n\r\n      return this;\r\n    },\r\n    connect: function() {\r\n      ctx.map.off('load', setup.connect);\r\n      clearInterval(mapLoadedInterval);\r\n      setup.addLayers();\r\n      ctx.store.storeMapConfig();\r\n      ctx.events.addEventListeners();\r\n    },\r\n    onAdd: function(map) {\r\n      if (process.env.NODE_ENV !== 'test') {\r\n        // Monkey patch to resolve breaking change to `fire` introduced by\r\n        // mapbox-gl-js. See mapbox/mapbox-gl-draw/issues/766.\r\n        const _fire = map.fire;\r\n        map.fire = function(type, event) {\r\n          let args = arguments;\r\n\r\n          if (_fire.length === 1 && arguments.length !== 1) {\r\n            args = [xtend({}, { type: type }, event)];\r\n          }\r\n\r\n          return _fire.apply(map, args);\r\n        };\r\n      }\r\n\r\n      ctx.map = map;\r\n      ctx.events = events(ctx);\r\n      ctx.ui = ui(ctx);\r\n      ctx.container = map.getContainer();\r\n      ctx.store = new Store(ctx);\r\n\r\n\r\n      controlContainer = ctx.ui.addButtons();\r\n\r\n      if (ctx.options.boxSelect) {\r\n        map.boxZoom.disable();\r\n        // Need to toggle dragPan on and off or else first\r\n        // dragPan disable attempt in simple_select doesn't work\r\n        map.dragPan.disable();\r\n        map.dragPan.enable();\r\n      }\r\n\r\n      if (map.loaded()) {\r\n        setup.connect();\r\n      } else {\r\n        map.on('load', setup.connect);\r\n        mapLoadedInterval = setInterval(() => { if (map.loaded()) setup.connect(); }, 16);\r\n      }\r\n\r\n      ctx.events.start();\r\n      return controlContainer;\r\n    },\r\n    addLayers: function() {\r\n      // drawn features style\r\n      ctx.map.addSource(Constants.sources.COLD, {\r\n        data: {\r\n          type: Constants.geojsonTypes.FEATURE_COLLECTION,\r\n          features: []\r\n        },\r\n        type: 'geojson'\r\n      });\r\n\r\n      // hot features style\r\n      ctx.map.addSource(Constants.sources.HOT, {\r\n        data: {\r\n          type: Constants.geojsonTypes.FEATURE_COLLECTION,\r\n          features: []\r\n        },\r\n        type: 'geojson'\r\n      });\r\n\r\n      ctx.options.styles.forEach(style => {\r\n        ctx.map.addLayer(style);\r\n      });\r\n\r\n      ctx.store.setDirty(true);\r\n      ctx.store.render();\r\n    },\r\n    // Check for layers and sources before attempting to remove\r\n    // If user adds draw control and removes it before the map is loaded, layers and sources will be missing\r\n    removeLayers: function() {\r\n      ctx.options.styles.forEach(style => {\r\n        if (ctx.map.getLayer(style.id)) {\r\n          ctx.map.removeLayer(style.id);\r\n        }\r\n      });\r\n\r\n      if (ctx.map.getSource(Constants.sources.COLD)) {\r\n        ctx.map.removeSource(Constants.sources.COLD);\r\n      }\r\n\r\n      if (ctx.map.getSource(Constants.sources.HOT)) {\r\n        ctx.map.removeSource(Constants.sources.HOT);\r\n      }\r\n    }\r\n  };\r\n\r\n  ctx.setup = setup;\r\n\r\n  return setup;\r\n};\r\n"]},"metadata":{},"sourceType":"script"}