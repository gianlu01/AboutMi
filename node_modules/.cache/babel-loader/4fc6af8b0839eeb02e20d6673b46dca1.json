{"ast":null,"code":"var _toConsumableArray = require(\"C:\\\\Users\\\\michele\\\\Desktop\\\\aboutmi\\\\node_modules\\\\@babel\\\\runtime/helpers/toConsumableArray\");\n\nvar CommonSelectors = require('../lib/common_selectors');\n\nvar isEventAtCoordinates = require('../lib/is_event_at_coordinates');\n\nvar doubleClickZoom = require('../lib/double_click_zoom');\n\nvar Constants = require('../constants');\n\nvar createVertex = require('../lib/create_vertex');\n\nvar DrawLineString = {};\n\nDrawLineString.onSetup = function (opts) {\n  opts = opts || {};\n  var featureId = opts.featureId;\n  var line, currentVertexPosition;\n  var direction = 'forward';\n\n  if (featureId) {\n    line = this.getFeature(featureId);\n\n    if (!line) {\n      throw new Error('Could not find a feature with the provided featureId');\n    }\n\n    var from = opts.from;\n\n    if (from && from.type === 'Feature' && from.geometry && from.geometry.type === 'Point') {\n      from = from.geometry;\n    }\n\n    if (from && from.type === 'Point' && from.coordinates && from.coordinates.length === 2) {\n      from = from.coordinates;\n    }\n\n    if (!from || !Array.isArray(from)) {\n      throw new Error('Please use the `from` property to indicate which point to continue the line from');\n    }\n\n    var lastCoord = line.coordinates.length - 1;\n\n    if (line.coordinates[lastCoord][0] === from[0] && line.coordinates[lastCoord][1] === from[1]) {\n      var _line;\n\n      currentVertexPosition = lastCoord + 1; // add one new coordinate to continue from\n\n      (_line = line).addCoordinate.apply(_line, [currentVertexPosition].concat(_toConsumableArray(line.coordinates[lastCoord])));\n    } else if (line.coordinates[0][0] === from[0] && line.coordinates[0][1] === from[1]) {\n      var _line2;\n\n      direction = 'backwards';\n      currentVertexPosition = 0; // add one new coordinate to continue from\n\n      (_line2 = line).addCoordinate.apply(_line2, [currentVertexPosition].concat(_toConsumableArray(line.coordinates[0])));\n    } else {\n      throw new Error('`from` should match the point at either the start or the end of the provided LineString');\n    }\n  } else {\n    line = this.newFeature({\n      type: Constants.geojsonTypes.FEATURE,\n      properties: {},\n      geometry: {\n        type: Constants.geojsonTypes.LINE_STRING,\n        coordinates: []\n      }\n    });\n    currentVertexPosition = 0;\n    this.addFeature(line);\n  }\n\n  this.clearSelectedFeatures();\n  doubleClickZoom.disable(this);\n  this.updateUIClasses({\n    mouse: Constants.cursors.ADD\n  });\n  this.activateUIButton(Constants.types.LINE);\n  this.setActionableState({\n    trash: true\n  });\n  return {\n    line: line,\n    currentVertexPosition: currentVertexPosition,\n    direction: direction\n  };\n};\n\nDrawLineString.clickAnywhere = function (state, e) {\n  if (state.currentVertexPosition > 0 && isEventAtCoordinates(e, state.line.coordinates[state.currentVertexPosition - 1]) || state.direction === 'backwards' && isEventAtCoordinates(e, state.line.coordinates[state.currentVertexPosition + 1])) {\n    return this.changeMode(Constants.modes.SIMPLE_SELECT, {\n      featureIds: [state.line.id]\n    });\n  }\n\n  this.updateUIClasses({\n    mouse: Constants.cursors.ADD\n  });\n  state.line.updateCoordinate(state.currentVertexPosition, e.lngLat.lng, e.lngLat.lat);\n\n  if (state.direction === 'forward') {\n    state.currentVertexPosition++;\n    state.line.updateCoordinate(state.currentVertexPosition, e.lngLat.lng, e.lngLat.lat);\n  } else {\n    state.line.addCoordinate(0, e.lngLat.lng, e.lngLat.lat);\n  }\n};\n\nDrawLineString.clickOnVertex = function (state) {\n  return this.changeMode(Constants.modes.SIMPLE_SELECT, {\n    featureIds: [state.line.id]\n  });\n};\n\nDrawLineString.onMouseMove = function (state, e) {\n  state.line.updateCoordinate(state.currentVertexPosition, e.lngLat.lng, e.lngLat.lat);\n\n  if (CommonSelectors.isVertex(e)) {\n    this.updateUIClasses({\n      mouse: Constants.cursors.POINTER\n    });\n  }\n};\n\nDrawLineString.onTap = DrawLineString.onClick = function (state, e) {\n  if (CommonSelectors.isVertex(e)) return this.clickOnVertex(state, e);\n  this.clickAnywhere(state, e);\n};\n\nDrawLineString.onKeyUp = function (state, e) {\n  if (CommonSelectors.isEnterKey(e)) {\n    this.changeMode(Constants.modes.SIMPLE_SELECT, {\n      featureIds: [state.line.id]\n    });\n  } else if (CommonSelectors.isEscapeKey(e)) {\n    this.deleteFeature([state.line.id], {\n      silent: true\n    });\n    this.changeMode(Constants.modes.SIMPLE_SELECT);\n  }\n};\n\nDrawLineString.onStop = function (state) {\n  doubleClickZoom.enable(this);\n  this.activateUIButton(); // check to see if we've deleted this feature\n\n  if (this.getFeature(state.line.id) === undefined) return; //remove last added coordinate\n\n  state.line.removeCoordinate(\"\".concat(state.currentVertexPosition));\n\n  if (state.line.isValid()) {\n    this.map.fire(Constants.events.CREATE, {\n      features: [state.line.toGeoJSON()]\n    });\n  } else {\n    this.deleteFeature([state.line.id], {\n      silent: true\n    });\n    this.changeMode(Constants.modes.SIMPLE_SELECT, {}, {\n      silent: true\n    });\n  }\n};\n\nDrawLineString.onTrash = function (state) {\n  this.deleteFeature([state.line.id], {\n    silent: true\n  });\n  this.changeMode(Constants.modes.SIMPLE_SELECT);\n};\n\nDrawLineString.toDisplayFeatures = function (state, geojson, display) {\n  var isActiveLine = geojson.properties.id === state.line.id;\n  geojson.properties.active = isActiveLine ? Constants.activeStates.ACTIVE : Constants.activeStates.INACTIVE;\n  if (!isActiveLine) return display(geojson); // Only render the line if it has at least one real coordinate\n\n  if (geojson.geometry.coordinates.length < 2) return;\n  geojson.properties.meta = Constants.meta.FEATURE;\n  display(createVertex(state.line.id, geojson.geometry.coordinates[state.direction === 'forward' ? geojson.geometry.coordinates.length - 2 : 1], \"\".concat(state.direction === 'forward' ? geojson.geometry.coordinates.length - 2 : 1), false));\n  display(geojson);\n};\n\nmodule.exports = DrawLineString;","map":null,"metadata":{},"sourceType":"script"}