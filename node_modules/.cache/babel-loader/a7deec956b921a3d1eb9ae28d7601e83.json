{"ast":null,"code":"var createVertex = require('./create_vertex');\n\nvar createMidpoint = require('./create_midpoint');\n\nvar Constants = require('../constants');\n\nfunction createSupplementaryPoints(geojson) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var basePath = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var _geojson$geometry = geojson.geometry,\n      type = _geojson$geometry.type,\n      coordinates = _geojson$geometry.coordinates;\n  var featureId = geojson.properties && geojson.properties.id;\n  var supplementaryPoints = [];\n\n  if (type === Constants.geojsonTypes.POINT) {\n    // For points, just create a vertex\n    supplementaryPoints.push(createVertex(featureId, coordinates, basePath, isSelectedPath(basePath)));\n  } else if (type === Constants.geojsonTypes.POLYGON) {\n    // Cycle through a Polygon's rings and\n    // process each line\n    coordinates.forEach(function (line, lineIndex) {\n      processLine(line, basePath !== null ? \"\".concat(basePath, \".\").concat(lineIndex) : String(lineIndex));\n    });\n  } else if (type === Constants.geojsonTypes.LINE_STRING) {\n    processLine(coordinates, basePath);\n  } else if (type.indexOf(Constants.geojsonTypes.MULTI_PREFIX) === 0) {\n    processMultiGeometry();\n  }\n\n  function processLine(line, lineBasePath) {\n    var firstPointString = '';\n    var lastVertex = null;\n    line.forEach(function (point, pointIndex) {\n      var pointPath = lineBasePath !== undefined && lineBasePath !== null ? \"\".concat(lineBasePath, \".\").concat(pointIndex) : String(pointIndex);\n      var vertex = createVertex(featureId, point, pointPath, isSelectedPath(pointPath)); // If we're creating midpoints, check if there was a\n      // vertex before this one. If so, add a midpoint\n      // between that vertex and this one.\n\n      if (options.midpoints && lastVertex) {\n        var midpoint = createMidpoint(featureId, lastVertex, vertex, options.map);\n\n        if (midpoint) {\n          supplementaryPoints.push(midpoint);\n        }\n      }\n\n      lastVertex = vertex; // A Polygon line's last point is the same as the first point. If we're on the last\n      // point, we want to draw a midpoint before it but not another vertex on it\n      // (since we already a vertex there, from the first point).\n\n      var stringifiedPoint = JSON.stringify(point);\n\n      if (firstPointString !== stringifiedPoint) {\n        supplementaryPoints.push(vertex);\n      }\n\n      if (pointIndex === 0) {\n        firstPointString = stringifiedPoint;\n      }\n    });\n  }\n\n  function isSelectedPath(path) {\n    if (!options.selectedPaths) return false;\n    return options.selectedPaths.indexOf(path) !== -1;\n  } // Split a multi-geometry into constituent\n  // geometries, and accumulate the supplementary points\n  // for each of those constituents\n\n\n  function processMultiGeometry() {\n    var subType = type.replace(Constants.geojsonTypes.MULTI_PREFIX, '');\n    coordinates.forEach(function (subCoordinates, index) {\n      var subFeature = {\n        type: Constants.geojsonTypes.FEATURE,\n        properties: geojson.properties,\n        geometry: {\n          type: subType,\n          coordinates: subCoordinates\n        }\n      };\n      supplementaryPoints = supplementaryPoints.concat(createSupplementaryPoints(subFeature, options, index));\n    });\n  }\n\n  return supplementaryPoints;\n}\n\nmodule.exports = createSupplementaryPoints;","map":null,"metadata":{},"sourceType":"script"}