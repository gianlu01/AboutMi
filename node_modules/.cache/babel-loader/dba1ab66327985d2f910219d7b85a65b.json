{"ast":null,"code":"const sortFeatures = require('./sort_features');\n\nconst mapEventToBoundingBox = require('./map_event_to_bounding_box');\n\nconst Constants = require('../constants');\n\nconst StringSet = require('./string_set');\n\nconst META_TYPES = [Constants.meta.FEATURE, Constants.meta.MIDPOINT, Constants.meta.VERTEX]; // Requires either event or bbox\n\nmodule.exports = {\n  click: featuresAtClick,\n  touch: featuresAtTouch\n};\n\nfunction featuresAtClick(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.clickBuffer);\n}\n\nfunction featuresAtTouch(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.touchBuffer);\n}\n\nfunction featuresAt(event, bbox, ctx, buffer) {\n  if (ctx.map === null) return [];\n  const box = event ? mapEventToBoundingBox(event, buffer) : bbox;\n  const queryParams = {};\n  if (ctx.options.styles) queryParams.layers = ctx.options.styles.map(s => s.id);\n  const features = ctx.map.queryRenderedFeatures(box, queryParams).filter(feature => {\n    return META_TYPES.indexOf(feature.properties.meta) !== -1;\n  });\n  const featureIds = new StringSet();\n  const uniqueFeatures = [];\n  features.forEach(feature => {\n    const featureId = feature.properties.id;\n    if (featureIds.has(featureId)) return;\n    featureIds.add(featureId);\n    uniqueFeatures.push(feature);\n  });\n  return sortFeatures(uniqueFeatures);\n}","map":{"version":3,"sources":["C:/Users/Gianluca/Documents/Scuola/Informatica/AboutMi/Sito/AboutMi/node_modules/@mapbox/mapbox-gl-draw/src/lib/features_at.js"],"names":["sortFeatures","require","mapEventToBoundingBox","Constants","StringSet","META_TYPES","meta","FEATURE","MIDPOINT","VERTEX","module","exports","click","featuresAtClick","touch","featuresAtTouch","event","bbox","ctx","featuresAt","options","clickBuffer","touchBuffer","buffer","map","box","queryParams","styles","layers","s","id","features","queryRenderedFeatures","filter","feature","indexOf","properties","featureIds","uniqueFeatures","forEach","featureId","has","add","push"],"mappings":"AAAA,MAAMA,YAAY,GAAGC,OAAO,CAAC,iBAAD,CAA5B;;AACA,MAAMC,qBAAqB,GAAGD,OAAO,CAAC,6BAAD,CAArC;;AACA,MAAME,SAAS,GAAGF,OAAO,CAAC,cAAD,CAAzB;;AACA,MAAMG,SAAS,GAAGH,OAAO,CAAC,cAAD,CAAzB;;AAEA,MAAMI,UAAU,GAAG,CACjBF,SAAS,CAACG,IAAV,CAAeC,OADE,EAEjBJ,SAAS,CAACG,IAAV,CAAeE,QAFE,EAGjBL,SAAS,CAACG,IAAV,CAAeG,MAHE,CAAnB,C,CAMA;;AACAC,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,KAAK,EAAEC,eADQ;AAEfC,EAAAA,KAAK,EAAEC;AAFQ,CAAjB;;AAKA,SAASF,eAAT,CAAyBG,KAAzB,EAAgCC,IAAhC,EAAsCC,GAAtC,EAA2C;AACzC,SAAOC,UAAU,CAACH,KAAD,EAAQC,IAAR,EAAcC,GAAd,EAAmBA,GAAG,CAACE,OAAJ,CAAYC,WAA/B,CAAjB;AACD;;AAED,SAASN,eAAT,CAAyBC,KAAzB,EAAgCC,IAAhC,EAAsCC,GAAtC,EAA2C;AACzC,SAAOC,UAAU,CAACH,KAAD,EAAQC,IAAR,EAAcC,GAAd,EAAmBA,GAAG,CAACE,OAAJ,CAAYE,WAA/B,CAAjB;AACD;;AAED,SAASH,UAAT,CAAoBH,KAApB,EAA2BC,IAA3B,EAAiCC,GAAjC,EAAsCK,MAAtC,EAA8C;AAC5C,MAAIL,GAAG,CAACM,GAAJ,KAAY,IAAhB,EAAsB,OAAO,EAAP;AAEtB,QAAMC,GAAG,GAAIT,KAAD,GAAUd,qBAAqB,CAACc,KAAD,EAAQO,MAAR,CAA/B,GAAiDN,IAA7D;AAEA,QAAMS,WAAW,GAAG,EAApB;AACA,MAAIR,GAAG,CAACE,OAAJ,CAAYO,MAAhB,EAAwBD,WAAW,CAACE,MAAZ,GAAqBV,GAAG,CAACE,OAAJ,CAAYO,MAAZ,CAAmBH,GAAnB,CAAuBK,CAAC,IAAIA,CAAC,CAACC,EAA9B,CAArB;AAExB,QAAMC,QAAQ,GAAGb,GAAG,CAACM,GAAJ,CAAQQ,qBAAR,CAA8BP,GAA9B,EAAmCC,WAAnC,EACdO,MADc,CACNC,OAAD,IAAa;AACnB,WAAO7B,UAAU,CAAC8B,OAAX,CAAmBD,OAAO,CAACE,UAAR,CAAmB9B,IAAtC,MAAgD,CAAC,CAAxD;AACD,GAHc,CAAjB;AAKA,QAAM+B,UAAU,GAAG,IAAIjC,SAAJ,EAAnB;AACA,QAAMkC,cAAc,GAAG,EAAvB;AACAP,EAAAA,QAAQ,CAACQ,OAAT,CAAkBL,OAAD,IAAa;AAC5B,UAAMM,SAAS,GAAGN,OAAO,CAACE,UAAR,CAAmBN,EAArC;AACA,QAAIO,UAAU,CAACI,GAAX,CAAeD,SAAf,CAAJ,EAA+B;AAC/BH,IAAAA,UAAU,CAACK,GAAX,CAAeF,SAAf;AACAF,IAAAA,cAAc,CAACK,IAAf,CAAoBT,OAApB;AACD,GALD;AAOA,SAAOlC,YAAY,CAACsC,cAAD,CAAnB;AACD","sourcesContent":["const sortFeatures = require('./sort_features');\nconst mapEventToBoundingBox = require('./map_event_to_bounding_box');\nconst Constants = require('../constants');\nconst StringSet = require('./string_set');\n\nconst META_TYPES = [\n  Constants.meta.FEATURE,\n  Constants.meta.MIDPOINT,\n  Constants.meta.VERTEX\n];\n\n// Requires either event or bbox\nmodule.exports = {\n  click: featuresAtClick,\n  touch: featuresAtTouch\n};\n\nfunction featuresAtClick(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.clickBuffer);\n}\n\nfunction featuresAtTouch(event, bbox, ctx) {\n  return featuresAt(event, bbox, ctx, ctx.options.touchBuffer);\n}\n\nfunction featuresAt(event, bbox, ctx, buffer) {\n  if (ctx.map === null) return [];\n\n  const box = (event) ? mapEventToBoundingBox(event, buffer) : bbox;\n\n  const queryParams = {};\n  if (ctx.options.styles) queryParams.layers = ctx.options.styles.map(s => s.id);\n\n  const features = ctx.map.queryRenderedFeatures(box, queryParams)\n    .filter((feature) => {\n      return META_TYPES.indexOf(feature.properties.meta) !== -1;\n    });\n\n  const featureIds = new StringSet();\n  const uniqueFeatures = [];\n  features.forEach((feature) => {\n    const featureId = feature.properties.id;\n    if (featureIds.has(featureId)) return;\n    featureIds.add(featureId);\n    uniqueFeatures.push(feature);\n  });\n\n  return sortFeatures(uniqueFeatures);\n}\n"]},"metadata":{},"sourceType":"script"}