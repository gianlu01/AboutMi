{"ast":null,"code":"const ModeHandler = function (mode, DrawContext) {\n  const handlers = {\n    drag: [],\n    click: [],\n    mousemove: [],\n    mousedown: [],\n    mouseup: [],\n    mouseout: [],\n    keydown: [],\n    keyup: [],\n    touchstart: [],\n    touchmove: [],\n    touchend: [],\n    tap: []\n  };\n  const ctx = {\n    on: function (event, selector, fn) {\n      if (handlers[event] === undefined) {\n        throw new Error(\"Invalid event type: \".concat(event));\n      }\n\n      handlers[event].push({\n        selector: selector,\n        fn: fn\n      });\n    },\n    render: function (id) {\n      DrawContext.store.featureChanged(id);\n    }\n  };\n\n  const delegate = function (eventName, event) {\n    const handles = handlers[eventName];\n    let iHandle = handles.length;\n\n    while (iHandle--) {\n      const handle = handles[iHandle];\n\n      if (handle.selector(event)) {\n        handle.fn.call(ctx, event);\n        DrawContext.store.render();\n        DrawContext.ui.updateMapClasses(); // ensure an event is only handled once\n        // we do this to let modes have multiple overlapping selectors\n        // and relay on order of oppertations to filter\n\n        break;\n      }\n    }\n  };\n\n  mode.start.call(ctx);\n  return {\n    render: mode.render,\n    stop: function () {\n      if (mode.stop) mode.stop();\n    },\n    trash: function () {\n      if (mode.trash) {\n        mode.trash();\n        DrawContext.store.render();\n      }\n    },\n    combineFeatures: function () {\n      if (mode.combineFeatures) {\n        mode.combineFeatures();\n      }\n    },\n    uncombineFeatures: function () {\n      if (mode.uncombineFeatures) {\n        mode.uncombineFeatures();\n      }\n    },\n    drag: function (event) {\n      delegate('drag', event);\n    },\n    click: function (event) {\n      delegate('click', event);\n    },\n    mousemove: function (event) {\n      delegate('mousemove', event);\n    },\n    mousedown: function (event) {\n      delegate('mousedown', event);\n    },\n    mouseup: function (event) {\n      delegate('mouseup', event);\n    },\n    mouseout: function (event) {\n      delegate('mouseout', event);\n    },\n    keydown: function (event) {\n      delegate('keydown', event);\n    },\n    keyup: function (event) {\n      delegate('keyup', event);\n    },\n    touchstart: function (event) {\n      delegate('touchstart', event);\n    },\n    touchmove: function (event) {\n      delegate('touchmove', event);\n    },\n    touchend: function (event) {\n      delegate('touchend', event);\n    },\n    tap: function (event) {\n      delegate('tap', event);\n    }\n  };\n};\n\nmodule.exports = ModeHandler;","map":null,"metadata":{},"sourceType":"script"}